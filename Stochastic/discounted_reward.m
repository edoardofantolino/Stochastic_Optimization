close all
clear
clc

p12 = 1/15;
p11 = 1-p12;
p23 = 1/15;
p22 = 1-p23;

% action 111111
% starting policy
P = [(1-2*(p12*p11)-(p12*p12)) (p12*p11)+(p12*p11) 0 (p12*p12) 0 0 ;
        0 (1-2*(p12*p11)-(p12*p12)) (p23*p11) (p22*p12) (p12*p23) 0 ;
        0 0 (p11) 0 (p12) 0; 0 0 0 (1-2*(p22*p23)-(p23*p23)) (p23*p22)+(p23*p22) (p23*p23);
        0 0 0 0 (p22) (p23); 1 0 0 0 0 0];

R = [2 1.5 0 1 0 0; 0 1.5 1 1 0.5 0; 0 0 1 0 0.5 0; 0 0 0 1 0.5 0; 0 0 0 0 0.5 0; -10 0 0 0 0 0];
    
% % action 112221
% P = [(1-2*(p12*p11)-(p12*p12)) (p12*p11)+(p12*p11) 0 (p12*p12) 0 0 ;
%         0 (1-2*(p12*p11)-(p12*p12)) (p23*p11) (p22*p12) (p12*p23) 0 ;
%         1 0 0 0 0 0; 1 0 0 0 0 0; 1 0 0 0 0 0; 1 0 0 0 0 0];
%    
% R = [2 1.5 0 1 0 0; 0 1.5 1 1 0.5 0; -6 0 0 0 0 0; -5 0 0 0 0 0; -7.5 0 0 0 0 0; -10 0 0 0 0 0];

     
% % action 122221
% % the advised policy
% P = [(1-2*(p12*p11)-(p12*p12)) (p12*p11)+(p12*p11) 0 (p12*p12) 0 0 ;
%       1 0 0 0 0 0; 1 0 0 0 0 0; 1 0 0 0 0 0; 1 0 0 0 0 0; 1 0 0 0 0 0];
%     
% R = [2 1.5 0 1 0 0; -3.5 0 0 0 0 0; -6 0 0 0 0 0; -5 0 0 0 0 0; -7.5 0 0 0 0 0; -10 0 0 0 0 0];

% % repair when one of the two is broken
% % action 112121
% P = [(1-2*(p12*p11)-(p12*p12)) (p12*p11)+(p12*p11) 0 (p12*p12) 0 0 ;
%         0 (1-2*(p12*p11)-(p12*p12)) (p23*p11) (p22*p12) (p12*p23) 0 ;
%       1 0 0 0 0 0; 0 0 0 (1-2*(p22*p23)-(p23*p23)) (p23*p22)+(p23*p22) (p23*p23);
%       1 0 0 0 0 0; 1 0 0 0 0 0];
%     
% R = [2 1.5 0 1 0 0; 0 1.5 1 1 0.5 0; -6 0 0 0 0 0; 0 0 0 1 0.5 0; -7.5 0 0 0 0 0; -10 0 0 0 0 0];

num_iter = 10000;
outer_iter = 1000;
rewards = zeros(outer_iter,1);

for iter=1:outer_iter
    states = zeros(num_iter, 1);

    states(1) = 1;
    actions(1) = 1;

    lambda = 0.995;
    tot_rew = 0;
    for k=2:num_iter
        states(k) = find(mnrnd(1,P(states(k-1),:)));
        tot_rew = tot_rew + lambda^k*R(states(k-1),states(k));
    end

    rewards(iter) = tot_rew;
end